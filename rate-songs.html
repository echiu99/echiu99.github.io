<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rate Songs</title>
  <style>
    /* Add your CSS styles here */
    body {
      font-family: "Times New Roman", Times, serif;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    .song-item {
      margin-bottom: 10px;
      text-align: center;
    }

    .button {
      display: block;
      width: 100%;
      padding: 10px;
      margin-top: 20px;
      text-align: center;
      background-color: #4CAF50;
      color: #fff;
      text-decoration: none;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Tournament Rating</h1>
    <div id="song-container"></div>
    <button class="button" id="next-button" disabled>Next</button>
  </div>

  <script>
    let allSongs = [];
    let currentPair = [];
    let winners = [];

    window.onload = async function () {
      const accessToken = localStorage.getItem('spotifyAccessToken');
      const selectedPlaylistId = localStorage.getItem('selectedPlaylistId');

      if (accessToken && selectedPlaylistId) {
        try {
          const response = await fetch(`https://api.spotify.com/v1/playlists/${selectedPlaylistId}/tracks`, {
            headers: {
              'Authorization': 'Bearer ' + accessToken
            }
          });
          const data = await response.json();

          // Extract relevant song data
          allSongs = data.items.map(item => ({
            name: item.track.name,
            artist: item.track.artists.map(artist => artist.name).join(', '),
            id: item.track.id,
          }));

          // Start the tournament
          nextRound();
        } catch (error) {
          console.error('Error fetching songs:', error);
          document.getElementById('song-container').innerText = 'Error fetching songs. Please try again later.';
        }
      } else {
        console.log('User not authorized or playlist not selected.');
      }
    };

    function nextRound() {
      if (allSongs.length > 1) {
        // Select two songs for the next matchup
        currentPair = allSongs.splice(0, 2);

        // Display the pair
        const songContainer = document.getElementById('song-container');
        songContainer.innerHTML = `
          <div class="song-item">
            <h3>${currentPair[0].name}</h3>
            <p>${currentPair[0].artist}</p>
            <button class="button" onclick="selectWinner(0)">Select</button>
          </div>
          <div class="song-item">
            <h3>${currentPair[1].name}</h3>
            <p>${currentPair[1].artist}</p>
            <button class="button" onclick="selectWinner(1)">Select</button>
          </div>
        `;
      } else if (allSongs.length === 1) {
        // Add the last song to winners
        winners.push(allSongs[0]);

        // Display the final winner
        displayWinner();
      } else {
        // Tournament complete
        allSongs = winners;
        winners = [];
        nextRound();
      }
    }

    function selectWinner(index) {
      winners.push(currentPair[index]);
      nextRound();
    }

    function displayWinner() {
      const songContainer = document.getElementById('song-container');
      const winner = winners[0];
      songContainer.innerHTML = `
        <h2>Winner: ${winner.name}</h2>
        <p>By ${winner.artist}</p>
      `;
    }
    // Go back to the Choose Playlist page
    function goBack() {
      // Optionally, you can clear the selected playlist ID
      localStorage.removeItem('selectedPlaylistId');
      window.location.href = 'choose-playlist.html';
    }
  </script>
</body>
</html>
